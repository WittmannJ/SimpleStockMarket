@using Microsoft.JSInterop
@inject IJSRuntime JS

<div>
    <canvas id="@ChartId" class="stock-chart"></canvas>
</div>

@code {
    [Parameter]
    public StockPriceResponse? StockData { get; set; }

    private string ChartId = $"chart-{Guid.NewGuid()}";

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender && StockData?.Prices.Any() == true)
        {
            var labels = StockData.Prices.Select(p => p.Date.ToString("yyyy-MM-dd")).ToList();
            var prices = StockData.Prices.Select(p => p.Close).ToList();

            await JS.InvokeVoidAsync("renderStockChart", ChartId, labels, prices, StockData.Symbol);
        }
    }
}
